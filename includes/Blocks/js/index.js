!function(){if(!window.wc||!window.wc.wcBlocksRegistry)return void console.error("[Avvance Blocks] wc.wcBlocksRegistry missing");const{registerPaymentMethod:e}=window.wc.wcBlocksRegistry,{__}=window.wp&&window.wp.i18n?window.wp.i18n:{__:e=>e},n=window.avvanceBlocks&&window.avvanceBlocks.label||__("U.S. Bank Avvance","avvance-for-woocommerce"),o=window.avvanceBlocks&&window.avvanceBlocks.button||__("Pay with Avvance","avvance-for-woocommerce"),a=window.avvanceBlocks&&window.avvanceBlocks.disclosure||"",t=()=>wp.element.createElement("div",{className:"avvance-disclosure"},a);e({name:"avvance",label:wp.element.createElement(()=>wp.element.createElement("strong",null,n)),content:wp.element.createElement(t),edit:wp.element.createElement(t),canMakePayment:()=>!0,ariaLabel:n,placeOrderButtonLabel:o,supports:{features:["products"]},paymentMethodId:"avvance",onPaymentProcessing:async({processingResponse:e})=>{try{const n=window.avvanceBlocks&&window.avvanceBlocks.initiateUrl||"",o=window.avvanceBlocks&&window.avvanceBlocks.statusUrl||"";if(!n||!o)return void e.reject({message:"Avvance endpoints not configured"});const a=window.open("about:blank","_blank","noopener,noreferrer");if(!a)return void e.reject({message:"Please allow pop-ups for Avvance or use another method."});try{a.opener=null}catch(e){}a.document.write("<!doctype html><title>U.S. Bank Avvance</title><p>Opening Avvanceâ€¦</p>");const t=await fetch(n,{method:"POST",credentials:"same-origin"}),c=await t.json();if(!c||!c.onboardingUrl||!c.guid)return a.close(),void e.reject({message:"Avvance is unavailable. Choose another method."});a.location=c.onboardingUrl;const r=async(e,n=18e4,a=3e3)=>{const t=Date.now();for(;Date.now()-t<n;){const n=await fetch(o+"?guid="+encodeURIComponent(e),{credentials:"same-origin"}),t=await n.json();if(t&&t.authorized&&t.orderReceivedUrl)return{ok:!0,url:t.orderReceivedUrl};if(t&&t.altPayment)return{alt:!0};await new Promise(e=>setTimeout(e,a))}return{timeout:!0}},i=await r(c.guid);i.ok?e.resolve({type:"success",redirectUrl:i.url}):i.alt?e.reject({message:"Avvance declined or errored. Please choose another method."}):e.reject({message:"Still waiting for Avvance. Please try again or pick another method."})}catch(n){e.reject({message:"Network error with Avvance. Please try again."})}}}),console.log("[Avvance Blocks] new-tab + polling enabled")}();